var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},i={},s=t.parcelRequire80e7;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in i){var s=i[t];delete i[t];var n={id:t,exports:{}};return e[t]=n,s.call(n.exports,n,n.exports),n.exports}var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){i[t]=e},t.parcelRequire80e7=s);var n=s("efez3"),o=s("cLG06");class a{constructor(t){this.providers=t,this.providers.sort(((t,e)=>t.weight-e.weight))}next(){if(!this.available())throw"Not Available";const t=this.providers.filter((t=>t.provider.available()));return o.randomItem(t).provider.next()}available(){return this.providers.some((t=>t.provider.available()&&t.weight>0))}updateProvider(t){this.providers=t}}var r=s("gBDHV"),l=s("kkgZr"),h=s("ipXH7");class d{constructor(t,e){this.randomNote=t,this.voiceInfo=e}nextQuestion(){const t=1/this.voiceInfo.voiceTime.beat_value*this.voiceInfo.voiceTime.num_beats/(1/this.voiceInfo.subDuration);return Array(t).fill(1).map((()=>this.randomNote.next()))}}class c{constructor(t=500){this.questionDelay=t,this.total=0,this.right=0,this.lastTime=0,this.spend=0}addRight(){this.right++,this.total++,this.calcDuration()}addWrong(){this.total++,this.calcDuration()}calcDuration(){0===this.lastTime||(this.spend+=Date.now()-this.lastTime-this.questionDelay),this.lastTime=Date.now()}getStatus(){return{total:this.total,right:this.right,spendTotal:this.spend,spendPer:this.spend/this.total}}reset(){this.right=0,this.total=0}}var u=s("jSbZi"),v=s("mDWTX");class g{constructor(t,e,i){this.elemID=t,this.pressCallBack=e,this.elem=document.getElementById(t),this.options=Object.assign({},{octaves:2,octaveBegin:3},i)}createPiano(){let t=this.getPianoHtml();this.elem.innerHTML=t,this.setEvents()}getPianoHtml(){let t='<ul class="piano">';for(let e=1;e<=this.options.octaves;e++){let e=this.options.octaveBegin;t+=this.getTones(e),this.options.octaveBegin++}return t+="</ul>",t}setEvents(){document.querySelectorAll("#"+this.elemID+" li ").forEach((t=>{t.addEventListener("click",(t=>{let e=t.target.dataset.note,i=e[e.length-1],s=e.substring(0,e.length-1);this.pressCallBack(`${s}/${i}`)}))}))}getNoteAndOctave(t,e){return t+e}getTones(t){return`\n            <li class="white c" data-note="${this.getNoteAndOctave("c",t)}"></li>\n            <li class="black cs" data-note="${this.getNoteAndOctave("c#",t)}"></li>\n            <li class="white d" data-note="${this.getNoteAndOctave("d",t)}"></li>\n            <li class="black ds" data-note="${this.getNoteAndOctave("d#",t)}"></li>\n            <li class="white e" data-note="${this.getNoteAndOctave("e",t)}"></li>\n            <li class="white f" data-note="${this.getNoteAndOctave("f",t)}"></li>\n            <li class="black fs" data-note="${this.getNoteAndOctave("f#",t)}"></li>\n            <li class="white g" data-note="${this.getNoteAndOctave("g",t)}"></li>\n            <li class="black gs" data-note="${this.getNoteAndOctave("g#",t)}"></li>\n            <li class="white a" data-note="${this.getNoteAndOctave("a",t)}"></li>\n            <li class="black as" data-note="${this.getNoteAndOctave("a#",t)}"></li>\n            <li class="white b" data-note="${this.getNoteAndOctave("b",t)}"></li>`}highlightKey(t){const e=t.replace("/","");let i=document.querySelector(`#${this.elemID} li[data-note="${e}"]`);null!=i&&i.classList.add("highlight")}removeKeyHighlight(){document.querySelectorAll(`#${this.elemID} li.highlight`).forEach((t=>{t.classList.remove("highlight")}))}}const p={1:110,2:130,4:150,8:300,16:520};const f=document.getElementById("output"),m=document.getElementById("question"),b=document.getElementById("clef-select"),y=document.getElementById("duration-select"),w=document.getElementById("noteIndex"),D=new class{constructor(t,e,i){this.indexElement=i,this.clef="treble",this.voidInfo={subDuration:1,voiceTime:{num_beats:4,beat_value:4},clef:this.clef},this.replayProvider=new l.ReplayProvider,this.coordNoteProvider=new a([{provider:this.replayProvider,weight:2},{provider:r.trebleNoteRanger,weight:1}]),this.questionProvider=new d(this.coordNoteProvider,this.voidInfo),this.stat=new c,this.question=[],this.index=0,this.staveDisplayer=new u.StaveDisplayer(t,this.clef),this.notedisplayer=new n.EqualDurationNoteDisplayer(this.staveDisplayer.getContext(),this.staveDisplayer.getStave(),this.voidInfo),this.virtualKeyboard=new g("piano-keyboard",this.onPianoPressed.bind(this),{octaveBegin:1,octaves:7}),this.virtualKeyboard.createPiano(),this.noteQuestion=new h.Question(e,this.virtualKeyboard),this.noteQuestion.resultCb=this.onAnswered.bind(this)}onPianoPressed(t){this.noteQuestion.extenalInput(t)}onAnswered(t,e){e?(this.replayProvider.addRight(t),this.stat.addRight()):(this.replayProvider.addWrong(t),this.stat.addWrong()),this.continueSeq()}setClef(t){t!==this.clef&&(this.clef=t,this.replayProvider.setClef(t),this.coordNoteProvider.updateProvider([{provider:this.replayProvider,weight:3},{provider:"bass"===t?r.bassNoteRanger:r.trebleNoteRanger,weight:1}]),this.staveDisplayer.setClef(t),this.staveDisplayer.draw(),this.notedisplayer.setClef(t),this.stat.reset(),this.question.length=0,this.continueSeq())}continueSeq(){0===this.question.length&&this.resetQuestion(),this.index++;const t=this.question.shift(),e=v.shuffle(v.shuffle(v.noteNear(t,4)).slice(0,3).concat(t));this.noteQuestion.setAnswer(t,e),this.indexElement.innerText=`No. ${this.index}`}resetQuestion(){this.index=0,this.question=this.questionProvider.nextQuestion(),this.notedisplayer.draw(this.question)}resetWidth(t){this.staveDisplayer.setWidth(t)}setSubDuration(t){this.voidInfo.subDuration=t,this.resetWidth(p[t]),this.question.length=0,this.continueSeq()}}(f,m,w);b.addEventListener("change",(function(){const t=this.value;D.setClef(t)})),y.addEventListener("change",(function(){const t=parseInt(this.value);D.setSubDuration(t)})),D.continueSeq();
//# sourceMappingURL=note-name.9659646c.js.map
